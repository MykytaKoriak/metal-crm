{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<h1>Календар слотів виробництва</h1>

<div id="calendar"></div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js'></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('calendar');

  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'timeGridWeek',        // тижневий календар як у Google
    locale: 'uk',
    firstDay: 1,
    nowIndicator: true,
    slotMinTime: '00:00:00',
    slotMaxTime: '24:00:00',
    height: 'auto',
      timeZone: 'UTC', // the default (unnecessary to specify)


    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay'
    },

    // забираємо події з нашого Django view
    events: "{% url 'production_slot_events' %}",

    // дозволяємо виділяти діапазон часу
    selectable: true,
    select: function(info) {
      const start = info.startStr;
      const end = info.endStr;

      // переходимо на стандартну admin-форму створення слота,
      // передаючи start/end у GET
      const url = `/admin/manufacture/productionslot/add/?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`;
      window.location.href = url;
    },

    // клік по вже існуючому слоту -> редагування
    eventClick: function(info) {
      const url = `/admin/manufacture/productionslot/${info.event.id}/change/`;
      window.location.href = url;
    }

  });

  calendar.render();
});
</script>

<style>
  #calendar {
    background: #fff;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
</style>
{% endblock %}
